var Client=function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){},function(e,t,n){"use strict";n.r(t),n.d(t,"newTrip",(function(){return M})),n.d(t,"getAPIData",(function(){return a})),n.d(t,"setData",(function(){return r})),n.d(t,"templateTrip",(function(){return i})),n.d(t,"getDays",(function(){return l})),n.d(t,"msToDate",(function(){return c})),n.d(t,"definitionTemp",(function(){return s})),n.d(t,"dataToString",(function(){return o}));const a=async e=>{const t=await fetch(e);try{return await t.json()}catch(e){console.log("Error API Data:",e)}},r=async(e="",t={})=>{const n=await fetch(e,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});try{return await n.json()}catch(e){console.log("Error installing data on the server: ",e)}},i=(e,t,n,a)=>{let r=document.createElement("div");r.classList.add("result-content");let i=`\n        <div class="result-info">\n            <figure class="info-image">\n                <img src="${n.photo}">\n                <figcaption>${n.city}</figcaption>\n            </figure>\n            <div class="country-info country">Country: \n                <span class="data">${n.country}</span>\n                <span class="flag"><img src="${n.flag?n.flag:""}"></span>\n            </div> \n            <div class="country-info">Capital:<span class="data">${n.capital?n.capital:" – "}</span></div>\n            <div class="country-info">Region:<span class="data">${n.region?n.region:" – "}</span></div>\n            <div class="country-info">Subregion:<span class="data">${n.subregion?n.subregion:" – "}</span></div>\n            <div class="country-info">Population:<span class="data">${n.population?n.population:" – "}</span></div>\n            <div class="country-info">languages:<span class="data">${n.languages?n.languages:" – "}</span></div>\n            <div class="country-info">Currencies:<span class="data">${n.currencies?n.currencies:" – "}</span></div>\n            <div class="country-info">Timezones:<span class="data">${n.timezones?n.timezones:" – "}</span></div>\n        </div> \n\n        <div class="result-trip">\n            <div class="trip-to">May trip to: <strong>${n.city}, ${n.country}</strong></div>\n            <div class="departing">Departing: <strong>${n.departing}</strong></div>\n\n            <div class="amount">${n.city}, ${n.country} is <strong>${n.amount}</strong> days away</div>\n\n            <div class="weather-content">\n                <div class="weather-start">\n                    <h2>Weather now (${n.startDay})</h2>\n                    <div class="weather-icon">\n                        <img src="media/${n.currentIcon}.png" />\n                    </div>\n                    <div class="weather-temp">\n                        <div class="weather-low">Low: <strong>${n.currentMin}</strong></div>\n                        <div class="weather-high">High: <strong>${n.currentMax}</strong></div>\n                    </div>\n                    <div class="weather-descr">${n.currentDescr}</div>\n                </div>\n\n                <div class="weather-depart">\n                    <h2>Weather in the future (${n.departing})</h2>\n                    <div class="weather-icon">\n                        <img src="media/${n.futureIcon}.png" />\n                    </div>\n                    <div class="weather-temp">\n                        <div class="weather-low">Low: <strong>${n.futureMin}</strong></div>\n                        <div class="weather-high">High: <strong>${n.futureMax}</strong></div>\n                    </div>\n                    <div class="weather-descr">${n.futureDescr}</div>\n                </div>\n            </div>\n\n            <div class="weather-range">Temperature range from <strong>${n.minTemp}</strong> to <strong>${n.maxTemp}</strong></div>\n\n            <div class="btn-group">\n                <button class="btn save-trip">Save Trip</button>\n                <button class="btn done-trip">${n.done?"Activate":"Done"}</button>\n                <button class="btn remove-trip">Remove Trip</button>\n            </div>\n        </div>\n    `;r.innerHTML=i,r.id=n.id,n.done&&r.classList.add("done"),I(r,n,a,n.id),"result"===a?e.append(r):t.prepend(r)},s=e=>{let t=[],n=[];return e.forEach(e=>{t.push(e.min_temp),n.push(e.max_temp)}),{min:Math.min.apply(null,t),max:Math.max.apply(null,n)}},o=(e,t)=>{let n=[];return e.forEach(e=>n.push(e[t])),n.join(", ")},c=()=>{let e=new Date,t=e.getDate(),n=t>10?t:"0"+t,a=e.getMonth()+1,r=a>10?a:"0"+a;return`${e.getFullYear()}/${r}/${n}`},l=(e,t)=>{let n=new Date(t).getTime();if(n>e){let t=n-e;return(Math.round(t/1e3/60/60*100)/100/24).toFixed(0)}return!1},d=document.getElementById("city"),u=document.getElementById("date"),p=document.getElementById("get"),g=JSON.parse(localStorage.getItem("trips")),v=document.getElementById("result-trip"),m=document.getElementById("list-trip"),y=document.querySelector(".error"),f=document.querySelector(".modal"),h=document.querySelector(".modal-curtain"),w=document.querySelector(".btn-delete"),b=document.querySelector(".btn-cancel"),$=document.querySelector(".question-delete"),S=document.querySelector(".loader");let T=[],x=!1,L="";let E="http://localhost:3030"===window.location.href?"http://localhost:3030/":"http://localhost:3030";const M=async()=>{if(v.innerHTML="",y.style.display="none",$.style.display="none",S.style.display="flex",f.classList.add("active"),x=!0,""===d.value||""===u.value)return y.style.display="block",y.innerText="Enter the city and date in the input fields!",k(),!1;{let e=Date.now(),t=l(e,u.value),n=t<15?t:15;if(!t)return y.style.display="block",y.innerText="Enter a date in the future!",u.value="",k(),!1;let r=await a(E+"/apidata"),{geoLogin:p,weatherKey:g,pixabayKey:f}=r,h="&username="+p,w="http://api.geonames.org/searchJSON?q="+d.value+h,b=await a(w);b.geonames[0]||q();let{lat:$,lng:T,name:x,countryName:L}=b.geonames[0],M=`https://api.weatherbit.io/v2.0/forecast/daily?lat=${$}&lon=${T}&key=${g}`,I=await a(M);I||q();let D=s(I.data),O=`https://pixabay.com/api/?key=${f}&q=${x}+${L}&image_type=photo`,_=await a(O);_||q();let j="https://restcountries.eu/rest/v2/name/"+L,N=await a(j);N[0]||q(),S.style.display="none";let{capital:J,region:P,subregion:H,timezones:B,population:C,currencies:z,languages:A,flag:R}=N[0],F={id:"trip_"+e,city:x,country:L,flag:R,capital:J,region:P,subregion:H,timezones:B.join(", "),population:C,currencies:o(z,"code"),languages:o(A,"name"),startDay:c(),departing:u.value.replace(/-/g,"/"),amount:t,photo:_.hits[0].webformatURL,minTemp:D.min,maxTemp:D.max,currentMin:I.data[0].min_temp,currentMax:I.data[0].max_temp,currentIcon:I.data[0].weather.icon,currentDescr:I.data[0].weather.description,futureMin:I.data[n].min_temp,futureMax:I.data[n].max_temp,futureIcon:I.data[n].weather.icon,futureDescr:I.data[n].weather.description,done:!1};i(v,m,F,"result"),d.value="",u.value=""}},I=(e,t,n,a)=>{let i=e.querySelector(".save-trip"),s=e.querySelector(".remove-trip"),o=e.querySelector(".done-trip");"result"===n?($.style.display="none",i.addEventListener("click",()=>{T.unshift(t),r(E+"/set",T),localStorage.setItem("trips",JSON.stringify(T)),v.innerHTML="",m.innerHTML="",O(),_()}),s.addEventListener("click",()=>{v.innerHTML="",_()})):($.style.display="block",i.style.display="none",o.addEventListener("click",()=>{D(a)}),s.addEventListener("click",()=>{L=a,_()}))},D=e=>{T.find(t=>{t.id===e&&(t.done=!t.done)});let t=document.querySelector("#"+e),n=t.classList.contains("done"),a=t.querySelector(".done-trip");n?(t.classList.remove("done"),a.innerText="Done"):(t.classList.add("done"),a.innerText="Activate"),r(E+"/done",{id:e}),localStorage.setItem("trips",JSON.stringify([])),localStorage.setItem("trips",JSON.stringify(T.reverse()))},O=async()=>{if(0===T.length&&null!==g)T=g.reverse(),T.forEach(e=>{i(v,m,e,"list")}),r(E+"/set",T.reverse());else try{const e=await fetch(E+"/get");T=await e.json(),T.reverse().forEach(e=>{i(v,m,e,"list")}),localStorage.setItem("trips",JSON.stringify(T.reverse()))}catch(e){console.log("error",e)}},q=()=>(y.style.display="block",y.innerText="You entered the wrong data!",d.value="",k(),!1);p.addEventListener("click",M),y.addEventListener("mouseover",()=>{y.style.display="none"}),w.addEventListener("click",()=>{(e=>{let t=document.getElementById(e);m.removeChild(t),T=T.filter(t=>t.id!==e),r(E+"/remove",{id:e}),localStorage.setItem("trips",JSON.stringify([])),localStorage.setItem("trips",JSON.stringify(T.reverse())),k()})(L)});const k=()=>{f.classList.remove("active"),x=!1},_=()=>{x?k():(f.classList.add("active"),x=!0)};h.addEventListener("click",k),b.addEventListener("click",k),window.onload=()=>O();n(0)}]);